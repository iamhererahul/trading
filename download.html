<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Download â€” Forex Trading Blueprint</title>
    <style>
      body {
        font-family: Inter, system-ui, Arial;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
        background: linear-gradient(180deg, #eef6ff, #ffffff);
        color: #0b1b3a;
      }
      .box {
        background: #fff;
        padding: 28px;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(2, 6, 23, 0.06);
        max-width: 720px;
        text-align: center;
      }
      .btn {
        background: #0066ff;
        color: #fff;
        padding: 12px 18px;
        border-radius: 10px;
        border: 0;
        font-weight: 700;
        cursor: pointer;
      }
      .muted {
        color: #6f7b8c;
        font-size: 14px;
      }
      .denied {
        color: #b33;
        font-weight: 700;
      }
    </style>
  </head>
  <body>
    <div class="box">
      <h2 id="title">Preparing your downloadâ€¦</h2>
      <p id="subtitle" class="muted">
        We will start your download automatically once payment is confirmed.
      </p>
      <div style="margin-top: 16px">
        <a id="dlBtn" class="btn" href="#" download style="display: none"
          >ðŸ“˜ Download eBook</a
        >
      </div>
      <p id="note" style="margin-top: 12px; font-size: 13px; color: #666">
        If the download doesn't start, click the button above.
      </p>
      <p id="denied" class="denied" style="display: none; margin-top: 12px">
        Access denied â€” invalid redirect or direct access.
      </p>
    </div>

    <script>
      /* ------------- CONFIG ------------- */
      // Direct download link (converted to Drive "uc?export=download" format)
      const DIRECT_DOWNLOAD =
        "https://drive.google.com/uc?export=download&id=1AwNsYn7eUIsTjLfZQGdxp-6676ACfH2y";

      /* ------------- Logic ------------- */
      function qp(name) {
        return new URL(location.href).searchParams.get(name);
      }

      function allowDownload() {
        // show UI
        document.getElementById("title").innerText =
          "Download ready â€” thank you!";
        document.getElementById("subtitle").innerText =
          "Your eBook should download automatically. If not, click the button below.";
        const dl = document.getElementById("dlBtn");
        dl.href = DIRECT_DOWNLOAD;
        dl.style.display = "inline-block";
        // trigger automatic download after short delay
        setTimeout(() => {
          // open in same tab to trigger download
          window.location.href = DIRECT_DOWNLOAD;
        }, 900);
      }

      // Detection checks (best-effort on static hosting):
      // 1) Query param ?paid=1 (set by Razorpay redirect configuration)
      // 2) URL contains razorpay or rzp payment id param (e.g. razorpay_payment_id)
      // 3) Referrer includes "razorpay" or "pages.razorpay"
      const paidParam = qp("paid") === "1";
      const hasPaymentId =
        qp("razorpay_payment_id") ||
        qp("payment_id") ||
        qp("payment_id") === true;
      const ref = document.referrer || "";
      const refOK =
        ref.includes("razorpay") ||
        ref.includes("pages.razorpay") ||
        ref.includes("rzp.io");

      if (paidParam || hasPaymentId || refOK) {
        allowDownload();
      } else {
        // show denied message â€” hide download button
        document.getElementById("title").innerText = "Unable to start download";
        document.getElementById("subtitle").innerText =
          "This page can only be accessed after a successful payment.";
        document.getElementById("denied").style.display = "block";
        document.getElementById("dlBtn").style.display = "none";
      }
    </script>
  </body>
</html>
